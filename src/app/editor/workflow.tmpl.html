<svg
  xmlns="http://www.w3.org/2000/svg"
  id="svg-container"
  x="0"
  y="0"
  ng-attr-width="{{vm.editorWidth}}"
  ng-attr-height="{{vm.editorHeight}}"
  ng-mousedown="vm.editorMouseDown($event)"
  ng-mousemove="vm.editorMouseMove($event)"
  ng-mouseup="vm.editorMouseUp($event)"
>

  <g
    ng-repeat="(id, node) in vm.model.nodes"
    ng-attr-id="{{node.id}}"
    ng-attr-x="{{node.x}}"
    ng-attr-y="{{node.y}}"
    ng-mousedown="vm.nodeMouseDown($event, node)"
    ng-mousemove="vm.nodeMouseMove($event, node)"
    ng-mouseup="vm.nodeMouseUp($event, node)"
    ng-init="hovering=false"
    draggable="vm.nodeDragOptions"
  >

    <rect
      ry="8"
      rx="8"
      ng-attr-width="{{vm.width(node)}}"
      ng-attr-height="{{vm.nodeHeight}}"
      fill="#cccccc"
      ng-class="vm.isNodeSelected(id) ? 'selected-node-rect' : 'node-rect'"
      ng-mouseenter="hovering=true"
      ng-mouseleave="hovering=false"
    >
    </rect>

    <text
      ng-attr-x="{{vm.width(node)/2}}"
      ng-attr-y="{{vm.nodeHeight/2}}"
      text-anchor="middle"
      alignment-baseline="middle"
      class="node-name"
    >
      {{node.interface.name}}
    </text>


    <g
      id="delete-button"
      ng-if="hovering && node.interface.name != 'input dataset'"
      ng-click="vm.deleteNode(node.id)"
    >
      <circle
        ng-attr-cx="{{node.x + vm.width(node) - 6}}"
        ng-attr-cy="{{node.y + 6}}"
        r="12"
        fill="black"
        stroke="white"
        stroke-width="4"
        ng-class="vm.isNodeSelected(id) ? 'selected-node-rect' : 'node-rect'"
      >
      </circle>
      <text
        ng-attr-y="{{node.y + 6}}"
        ng-attr-x="{{node.x + vm.width(node) - 6}}"
        fill="white"
        text-anchor="middle"
        alignment-baseline="middle"
        class="node-name"
      >
        X
      </text>
    </g>


    <g
      ng-repeat="(input, value) in node.interface.inputs"
      class="connector input-connector" ng-init="showText=false"
    >
      <text
        ng-if="showText"
        ng-attr-y="{{node.y+10}}"
        ng-attr-x="{{28 + ($index*14)}}"
        text-anchor="middle"
        alignment-baseline="middle"
        class="connector-name"
      >
        {{input}}
      </text>

      <circle
        r="4"
        ng-attr-cx="{{28 + ($index*14)}}"
        cy="0"
        ng-class="vm.isNodeSelected(id) ? 'selected-connector-circle' : 'connector-circle'"
        ng-mouseenter="showText=true"
        ng-mouseleave="showText=false"
      />
    </g>

    <g
      ng-repeat="(output, value) in node.interface.outputs"
      class="connector output-connector" ng-init="showText=false"
    >
      <text
        ng-if="showText"
        ng-attr-x="{{28 + ($index*14)}}"
        ng-attr-y="{{node.x + (vm.nodeHeight-10)}}"
        text-anchor="middle"
        alignment-baseline="middle"
        class="connector-name"
      >
        {{output}}
      </text>

      <circle
        r="4"
        ng-attr-cx="{{28 + ($index*14)}}"
        ng-attr-cy="{{vm.nodeHeight}}"
        ng-class="vm.isNodeSelected(id) ? 'selected-connector-circle' : 'connector-circle'"
        ng-mouseenter="showText=true"
        ng-mouseleave="showText=false"
      />
    </g>
  </g>


  <g
    ng-repeat="edge in vm.model.edges"
    class="edge"
  >
    <path
      ng-class="vm.isEdgeSelected(id) ? 'selected-edge' : 'edge'"
      ng-attr-d="M {{edge.sourceCoordX()}}, {{edge.sourceCoordY()}}
C {{edge.sourceTangentX()}}, {{edge.sourceTangentY()}}
{{edge.destTangentX()}}, {{edge.destTangentY()}}
{{edge.destCoordX()}}, {{edge.destCoordY()}}"
    >
    </path>
    <circle
      ng-class="vm.isEdgeSelected(id) ? 'selected-edge-endpoint' : 'edge-endpoint'"
      r="4"
      ng-attr-cx="{{edge.sourceCoordX()}}"
      ng-attr-cy="{{edge.sourceCoordY()}}"
    >
    </circle>

    <circle
      ng-class="vm.isEdgeSelected(id) ? 'selected-edge-endpoint' : 'edge-endpoint'"
      r="4"
      ng-attr-cx="{{edge.destCoordX()}}"
      ng-attr-cy="{{edge.destCoordY()}}"
    >
    </circle>
  </g>

  <g
    ng-if="vm.currentlyDrawingEdge"
  >
    <path
      class="dragging-edge dragging-edge-line"
      ng-attr-d="M {{vm.dragPoint1.x}}, {{vm.dragPoint1.y}}
C {{vm.dragTangent1.x}}, {{vm.dragTangent1.y}}
{{vm.dragTangent2.x}}, {{vm.dragTangent2.y}}
{{vm.dragPoint2.x}}, {{vm.dragPoint2.y}}"
    >
    </path>

    <circle
      class="dragging-edge dragging-edge-endpoint"
      r="4"
      ng-attr-cx="{{dragPoint1.x}}"
      ng-attr-cy="{{dragPoint1.y}}"
    >
    </circle>

    <circle
      class="dragging-edge dragging-edge-endpoint"
      r="4"
      ng-attr-cx="{{dragPoint2.x}}"
      ng-attr-cy="{{dragPoint2.y}}"
    >
    </circle>
  </g>


  <g
    ng-if="vm.currentlyDrawingSelectionRect"
  >
    <path
      ng-attr-d="M {{vm.dragSelectionRect.x1}},{{vm.dragSelectionRect.y1}} H {{vm.dragSelectionRect.x2}} V {{vm.dragSelectionRect.y2}} H {{vm.dragSelectionRect.x1}} Z"
      class="dragging-edge"/>
  </g>


</svg>
